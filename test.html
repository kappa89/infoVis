<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <title>Infovis Project - Marco Cappello 418680</title>
  <script type='text/javascript' src="script/d3.v3.js"></script>

</head>
<body>
  <h2>Progetto InfoVis - Marco Cappello 418680</h2>
  <h3>Disegna 30 quadrifogli (Ã¨ sufficiente la silhouette) che si si muovono allontanandosi dalla posizione corrente del mouse (le sovrapposizioni sono permesse). Quando una figurella arriva a pochi millimetri dal bordo del disegno scompare e ricompare al centro.</h3>

  <script>
var width = 960,
    height = 500;

var flowerRadius = 30;
var globalCenter = [width/2.0,
                    height/2.0];

var nodes = d3.range(30).map(function() { return {radius: flowerRadius}; }),
    root = nodes[0],
    color = d3.scale.category10();

root.radius = 50;
root.fixed = true;

var force = d3.layout.force()
    .gravity(0.0)
    .charge(function(d,i){return i ? 0 : -500;})
    .nodes(nodes)
    .size([width, height]);

force.start();

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);
    
    svg.append("rect")
    .attr("width", width)
    .attr("height", height)
    .style("stroke", "black")
    .style("fill", "none")
    .style("stroke-width", 3);


svg.selectAll("circle")
    .data(nodes.slice(1)) //no root
    .enter().append("circle")
    .attr("r", function(d) { return d.radius; })
    .style("fill", function(d, i) { return color(i % 3); });

function setCenter(index)
{
    index = index + 1;
    console.log(nodes[index]);
    nodes[index].x = globalCenter[0];
    nodes[index].y = globalCenter[1];
    nodes[index].px = globalCenter[0];
    nodes[index].py = globalCenter[1];
}

force.on("tick", function(e) {

 svg.selectAll("circle")
      .attr("cx", function(d, i) {
          if((d.x > (width - flowerRadius)) || d.x < flowerRadius)
          {
              console.log("Sono sul bordo X");
              return setCenter(i);
          }
          return d.x;
        })
      .attr("cy", function(d, i) {
         if(d.y > height-flowerRadius || d.y < flowerRadius)
         {
              console.log("Sono sul bordo Y");
              return setCenter(i);
          }
          return d.y;
    });
});

svg.on("mousemove", function() {
  var p1 = d3.mouse(this);
  root.px = p1[0];
  root.py = p1[1];
  force.resume();
});

 </script>
</body>